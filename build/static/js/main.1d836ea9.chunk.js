(this["webpackJsonpchat-socket-frontend"]=this["webpackJsonpchat-socket-frontend"]||[]).push([[0],{177:function(e,t,n){},207:function(e,t){},209:function(e,t){},221:function(e,t){},223:function(e,t){},250:function(e,t){},252:function(e,t){},253:function(e,t){},258:function(e,t){},260:function(e,t){},279:function(e,t){},291:function(e,t){},294:function(e,t){},319:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),s=n(13),o=n(58),a=n.n(o),i=n(5),l=(n(177),n(6)),u=n(31),d=n(38),b=n(164),j=n.n(b),h=n(60),m=n.n(h),f=n(7),x=n.n(f),g=n(24),p=n(90),O=n(50),v=n.n(O),y="/api/channels",N={getAll:function(){var e=Object(g.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.get(y);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getById:function(){var e=Object(g.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.get("".concat(y,"/").concat(t));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),create:function(){var e=Object(g.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.post(y,t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),updateChannelUsers:function(){var e=Object(g.a)(x.a.mark((function e(t,n){var r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.patch("".concat(y,"/").concat(t),n);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CREATE_CHANNEL":return[t.data].concat(Object(d.a)(e));case"UPDATE_MESSAGES":var n=Object(p.a)(Object(p.a)({},e),{},{messages:[].concat(Object(d.a)(e.messages),[t.data])});return n;case"UPDATE_CHANNEL":var r=t.data,c=e.map((function(e){return e.id===r.id?r:e}));return c;case"GET_SINGLE_CHANNEL":case"INIT_CHANNELS":return t.data;default:return e}},E=function(e){var t=Object(r.useState)([]),n=Object(u.a)(t,2),c=n[0],s=n[1],o=Object(r.useRef)(),a=Object(i.c)((function(e){return e.activeUser})),l=Object(i.b)();console.log("in hook users",c),Object(r.useEffect)((function(){return a?(l((t=e,function(){var e=Object(g.a)(x.a.mark((function e(n){var r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.getById(t);case 3:return r=e.sent,e.abrupt("return",n({type:"GET_SINGLE_CHANNEL",data:r}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",console.log("Error fetching single channel",e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}())),o.current=j()({query:{roomId:e,user:a}}),console.log("in use hook"),console.log("emit",a),o.current.emit("userJoinRoom",a),o.current.on("newChatMessage",(function(e){console.log("GETTING NEW MESSAGE",e),l({type:"UPDATE_MESSAGES",data:e})})),o.current.on("userJoinRoom",(function(e){console.log("joining room is usehook"),s((function(t){return t.some((function(t){return t.id===e.id}))?Object(d.a)(t):[].concat(Object(d.a)(t),[e])}))})),o.current.on("roomListChange",(function(e){console.log("room list change happened"),s((function(){return console.log(e),e.users}))})),o.current.on("userLeaveRoom",(function(e){s((function(t){return console.log("Old USERS",t),console.log("LEFT USER",e),t.filter((function(t){return t.id!==e.id}))}))})),function(){return o.current.disconnect()}):(console.log("useHook no user found"),null);var t}),[e,a]);return{sendMessage:function(e){o.current.emit("newChatMessageToServer",{content:e,author:{username:a.username,id:a.id},date:(new Date).toLocaleDateString("ru-RU",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),id:m.a.randomBytes(12).toString("hex")})},users:c,socketRef:o}},S=n(0),C=function(){var e=Object(r.useRef)();return Object(r.useEffect)((function(){return e.current.scrollIntoView({behavior:"smooth"})})),Object(S.jsx)("div",{ref:e})},k=function(e){var t=e.user,n=e.msg;return Object(S.jsxs)("div",{className:t.id===n.author.id?"flex flex-row-reverse items-baseline space-x-1":"flex flex-row items-baseline space-x-1",children:[Object(S.jsx)("span",{className:t.id.toString()===n.author.id.toString()?"bg-green-200 mx-3 mb-3 p-1 rounded w-52 self-end":"bg-blue-200 ml-3 mb-3 p-1 rounded w-52 self-start",children:n.content}),Object(S.jsx)("span",{className:"text-gray-300 text-sm self-start",children:n.date}),t.id!==n.author.id?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)("br",{}),Object(S.jsx)("span",{className:"text-gray-500 self-start px-2",children:n.author.username})]}):null]})},L=function(){var e=Object(l.g)().roomId,t=E(e),n=t.sendMessage,c=t.users,s=Object(r.useState)(""),o=Object(u.a)(s,2),a=o[0],d=o[1],b=Object(i.c)((function(e){return e.activeUser})),j=Object(i.c)((function(e){return e.channels.messages}));return b?Object(S.jsx)("div",{className:"md:grid md:grid-cols-5",children:Object(S.jsxs)("div",{className:"mx-3 md:col-start-2 md:col-span-3 shadow-sm border rounded px-5 py-3 mt-5 text-center",children:[Object(S.jsxs)("h1",{className:"font-bold text-xl mb-2",children:["Room:"," ","#",e]}),Object(S.jsxs)("div",{className:"md:grid md:grid-cols-4",children:[Object(S.jsxs)("div",{className:"col-span-1 pt-2 col-start-1 bg-blue-100 rounded-t md:rounded-tr-none border border-gray-400",children:[Object(S.jsx)("h2",{className:"font-semibold",children:"Users in room:"}),Object(S.jsx)("ul",{children:c.map((function(e){return Object(S.jsx)("li",{children:e.username},e.id)}))})]}),Object(S.jsxs)("div",{className:"col-span-3 col-start-2 border border-gray-400 md:rounded-tr pt-2 md:border-l-0",children:[Object(S.jsx)("h2",{className:"font-semibold text-lg",children:"Chat"}),Object(S.jsx)("div",{className:"h-80 overflow-auto",children:Object(S.jsxs)("ul",{className:"flex flex-col items-baseline",children:[j?Object(S.jsx)(S.Fragment,{children:j.map((function(e){return Object(S.jsx)("li",{className:b.id===e.author.id?"self-end items-baseline":"self-start items-baseline",children:Object(S.jsx)(k,{user:b,msg:e})},e.id)}))}):"No messages yet..",Object(S.jsx)(C,{})]})})]}),Object(S.jsxs)("form",{className:"md:col-span-4",onSubmit:function(e){e.preventDefault(),n(a),d("")},children:[Object(S.jsx)("input",{type:"text",placeholder:"Send a message...",value:a,onChange:function(e){var t=e.target;return d(t.value)},className:"w-5/6 rounded-bl shadow-sm border-r-0 border-t-0 border-gray-400 hover:bg-gray-100 hover:border-gray-500"}),Object(S.jsx)("button",{type:"submit",className:"w-1/6 focus:ring-2 shadow-sm px-3 py-2 border border-t-0 border-gray-400 hover:border-gray-500 rounded-br font-semibold focus:outline-none hover:bg-green-200 focus:bg-green-300",children:"Send"})]})]})]})}):(console.log("no user"),Object(S.jsx)("div",{className:"text-center",children:Object(S.jsx)("h1",{className:"font-bold text-xl mt-3",children:"Please login to see chat!"})}))},A=function(){return window.localStorage.removeItem("chatAppUser"),console.log("logged out"),{type:"REMOVE_USER"}},I=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"INIT_USER":case"LOGIN_USER":return t.data.user;case"REMOVE_USER":return null;default:return e}},U=function(){var e=Object(r.useState)(""),t=Object(u.a)(e,2),n=t[0],c=t[1],s=Object(r.useState)(""),o=Object(u.a)(s,2),a=o[0],l=o[1],d="font-bold text-xl mb-2",b="rounded-l shadow-sm border-r-0 border-gray-400 hover:bg-gray-100 hover:border-gray-500",j="focus:ring-2 shadow-sm px-3 py-2 border border-gray-400 hover:border-gray-500 rounded-r font-semibold focus:outline-none hover:bg-gray-200 focus:bg-gray-300",h=Object(i.b)(),f=Object(i.c)((function(e){return e.activeUser}));return Object(S.jsx)("div",{className:"md:grid md:grid-cols-5",children:Object(S.jsxs)("div",{className:"mx-3 md:col-start-2 md:col-span-3 rounded shadow-sm border px-5 py-3 mt-5 text-center",children:[f?Object(S.jsxs)("div",{children:["Hello,"," ",f.username,"!",Object(S.jsx)("button",{type:"button",onClick:function(){return h(A())},className:"px-2 py-1 mx-2 border hover:bg-gray-200 focus:outline-none focus:ring-2 border-gray-400 hover:border-gray-500 rounded shadow-sm font-semibold",children:"Logout"})]}):Object(S.jsxs)("div",{children:[Object(S.jsx)("h1",{className:d,children:"Enter your name"}),Object(S.jsxs)("form",{onSubmit:function(e){e.preventDefault(),h(function(e){var t={username:e,id:m.a.randomBytes(12).toString("hex")};return window.localStorage.setItem("chatAppUser",JSON.stringify(t)),{type:"LOGIN_USER",data:{user:t}}}(n)),c("")},children:[Object(S.jsx)("input",{type:"text",placeholder:"Enter your name...",value:n,onChange:function(e){var t=e.target;return c(t.value)},className:b}),Object(S.jsx)("button",{type:"submit",className:j,children:"Set"})]})]}),Object(S.jsx)("h2",{className:d,children:"Create a new room or join existing"}),f?Object(S.jsxs)("form",{onSubmit:function(e){var t;e.preventDefault(),h((t={name:a,creator:f.username},function(){var e=Object(g.a)(x.a.mark((function e(n){var r;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.create(t);case 3:return r=e.sent,e.abrupt("return",n({type:"CREATE_CHANNEL",data:r}));case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",console.log("Error creating a new channel",e.t0));case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}())),l("")},children:[Object(S.jsx)("input",{type:"text",placeholder:"Enter room name",value:a,onChange:function(e){var t=e.target;return l(t.value)},className:b}),Object(S.jsx)("button",{type:"submit",className:j,children:"Create"})]}):"Login to create and join rooms!"]})})},R=function(){var e=Object(i.c)((function(e){return e.channels})),t=Object(i.b)();return Object(r.useEffect)((function(){t(function(){var e=Object(g.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N.getAll();case 3:n=e.sent,t({type:"INIT_CHANNELS",data:n}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log("Error initializing posts",e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}())}),[]),Array.isArray(e)?Object(S.jsx)("div",{className:"md:grid md:grid-cols-5",children:Object(S.jsxs)("div",{className:"mx-3 md:col-start-2 md:col-span-3 shadow-sm border rounded px-5 py-3 mt-5 text-center",children:[Object(S.jsx)("h2",{className:"font-bold text-xl mb-2",children:"List of channels available"}),e?Object(S.jsx)("ul",{children:e.map((function(e){return Object(S.jsx)(s.b,{to:"/channels/".concat(e.id),children:Object(S.jsx)("li",{className:"border-gray-400 hover:border-gray-600 font-semibold border-2 rounded shadow-sm p-5 mb-3 bg-gray-50 hover:bg-gray-200",children:e.name})},e.id)}))}):"Loading..."]})}):"loading..."},_=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_OPENED":return!0;case"SET_CLOSED":return!1;default:return e}},T="text-white px-2 hover:text-yellow-100 text-m",M="text-white hover:text-yellow-600 min-w-full hover:bg-gray-100 hover:opacity-50 block px-3 py-2 rounded-md text-base font-medium",D=function(){var e=Object(i.b)(),t=Object(i.c)((function(e){return e.mobileNavOpened}));console.log("OPEND:",t);return Object(S.jsx)("div",{className:"-mr-2 flex justify-end items-end md:hidden",children:Object(S.jsx)("button",{type:"button",className:"bg-green-300 mb-2 inline-flex items-end justify-end p-2 rounded-md text-gray-400 hover:text-white hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white","aria-controls":"mobile-menu",onClick:function(){return e(t?{type:"SET_CLOSED"}:{type:"SET_OPENED"})},children:t?Object(S.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",stroke:"currentColor",className:"block h-6 w-6",viewBox:"0 0 16 16",children:[Object(S.jsx)("path",{d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),Object(S.jsx)("path",{d:"M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"})]}):Object(S.jsx)("svg",{className:"block h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor","aria-hidden":"true",children:Object(S.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 6h16M4 12h16M4 18h16"})})})})},H=function(){var e=Object(i.c)((function(e){return e.activeUser})),t=Object(i.b)(),n=Object(i.c)((function(e){return e.mobileNavOpened}));return Object(S.jsxs)("div",{className:"px-5",children:[Object(S.jsx)(D,{}),Object(S.jsx)("div",{className:"flex flex-wrap text-center mx-auto justify-items-center space-y-1",children:n?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(s.c,{to:"/new-channel",activeClassName:"font-bold",className:M,children:"New channel"}),e?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(s.c,{to:"/channels/all",activeClassName:"font-bold",className:M,children:"All channels"}),Object(S.jsx)("div",{className:"flex justify-items-end items-end",children:Object(S.jsx)("button",{type:"button",onClick:function(){return t(A())},className:" text-right px-3 inline-flex self-end justify-end py-1 shadow-sm text-sm font-medium rounded-md text-white bg-orange-400 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",children:"Logout"})})]}):Object(S.jsx)(s.c,{to:"/new-channel",activeClassName:"font-bold",className:M,children:"Login"})]}):""})]})},G=function(){var e=Object(i.c)((function(e){return e.activeUser})),t=Object(i.b)();return Object(S.jsxs)("div",{className:"bg-blue-500 py-4",children:[Object(S.jsx)("div",{className:"flex justify-end space-x-4",children:Object(S.jsxs)("div",{className:"hidden md:block px-10",children:[Object(S.jsx)(s.c,{to:"/new-channel",activeClassName:"font-bold",className:T,children:"New channel"}),e?Object(S.jsxs)(S.Fragment,{children:[Object(S.jsx)(s.c,{to:"/channels/all",activeClassName:"font-bold",className:T,children:"All channels"}),Object(S.jsxs)("span",{className:"text-white mr-2",children:["Hello,"," ",e.username,"!"]}),Object(S.jsx)("button",{type:"button",onClick:function(){return t(A())},className:"px-3 py-1 mx-2 shadow-sm text-sm font-medium rounded-md text-white bg-orange-400 hover:bg-orange-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",children:"Logout"})]}):Object(S.jsx)(s.c,{to:"/new-channel",activeClassName:"font-bold",className:"px-3 py-1 mx-2 shadow-sm text-sm font-medium rounded-md text-white bg-green-500 hover:bg-green-400 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500",children:"Login"})]})}),Object(S.jsx)("div",{className:"md:hidden ml-0",children:Object(S.jsx)(H,{})})]})},P=function(){return Object(S.jsx)("div",{children:Object(S.jsx)("h1",{children:"Error 404. Page not found!"})})},B=function(){var e=Object(i.b)();return Object(r.useEffect)((function(){e(function(){var e,t=window.localStorage.getItem("chatAppUser");return console.log("to parse:",t),t&&(e=JSON.parse(t),console.log("Found logged in user:",e)),{type:"INIT_USER",data:{user:e||null}}}())}),[]),Object(S.jsxs)("div",{children:[Object(S.jsx)(G,{}),Object(S.jsxs)(l.d,{children:[Object(S.jsx)(l.b,{exact:!0,path:"/channels/all",component:R}),Object(S.jsx)(l.b,{path:"/channels/:roomId",children:Object(S.jsx)(L,{})}),Object(S.jsx)(l.b,{exact:!0,path:"/new-channel",component:U}),Object(S.jsx)(l.b,{exact:!0,path:"/",children:Object(S.jsx)(l.a,{to:"/new-channel"})}),Object(S.jsx)(l.b,{path:"*",component:P})]})]})},F=n(30),J=n(165),V=n(166),z=Object(F.combineReducers)({activeUser:I,channels:w,mobileNavOpened:_}),W=Object(F.createStore)(z,Object(J.composeWithDevTools)(Object(F.applyMiddleware)(V.a)));a.a.render(Object(S.jsx)(i.a,{store:W,children:Object(S.jsx)(s.a,{children:Object(S.jsx)(c.a.StrictMode,{children:Object(S.jsx)(B,{})})})}),document.getElementById("root"))}},[[319,1,2]]]);
//# sourceMappingURL=main.1d836ea9.chunk.js.map